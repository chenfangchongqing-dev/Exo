<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>听力 CO｜目录</title>
  <link rel="stylesheet" href="../style.css" />
  <style>
    body{
      font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background:#f7f7fb;
      margin:0;
      color:#0f172a;
    }
    .page{
      max-width:1000px;
      margin:0 auto;
      padding:20px;
    }
    h1{margin:.2rem 0;}
    .searchbar{
      margin:16px 0;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
    }
    .searchbar input,.searchbar select{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid #d1d5db;
      font-size:0.95rem;
    }
    #q{flex:1 1 220px;}
    #list{
      display:flex;
      flex-direction:column;
      gap:12px;
      margin-top:16px;
    }
    .cardlink{
      display:block;
      padding:12px 14px;
      border-radius:14px;
      border:1px solid #e5e7eb;
      background:#fff;
      text-decoration:none;
      color:inherit;
      box-shadow:0 6px 18px rgba(15,23,42,0.06);
    }
    .cardlink-title{font-weight:600;margin-bottom:4px;}
    .cardlink-meta{font-size:0.9rem;color:#6b7280;margin-bottom:4px;}
    .tags{display:flex;flex-wrap:wrap;gap:4px;margin-top:4px;}
    .tag{
      font-size:0.8rem;
      padding:2px 8px;
      border-radius:999px;
      background:#e5f0ff;
      color:#1d4ed8;
    }
    #chips{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top:6px;
    }
    .chip{
      font-size:0.8rem;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid #e5e7eb;
      background:#fff;
      cursor:pointer;
      color:#4b5563;
    }
    .chip.active{
      background:#0ea5e9;
      color:#fff;
      border-color:#0ea5e9;
    }
    #empty{margin-top:18px;color:#6b7280;font-size:0.95rem;}
    footer{margin-top:24px;font-size:0.85rem;color:#9ca3af;}
  </style>
</head>
<body>
  <div class="page">
    <a href="../" style="text-decoration:none;color:#0ea5e9">← 返回首页</a>

    <h1>听力 CO</h1>
    <p>支持按 <strong>单元</strong>（U1…U9）与<strong>主题</strong>搜索与筛选。练习按单元放在 <code>CO/U1/…U9/</code> 子文件夹。</p>

    <!-- 搜索 + 筛选 -->
    <div class="searchbar">
      <input id="q" type="search" placeholder="搜索：标题 / 单元（如 U3）/ 主题 / 标签…" />
      <select id="unit">
        <option value="">全部单元</option>
      </select>
      <select id="theme">
        <option value="">全部主题</option>
      </select>
    </div>

    <!-- 快捷标签 -->
    <div id="chips"></div>

    <!-- 目录列表 -->
    <div id="list"></div>
    <p id="empty">暂无匹配结果。</p>

    <p style="margin-top:24px;font-size:0.9rem;color:#6b7280;">
      如何添加：<br>
      1）把练习 HTML 放到 <code>CO/U1/…U9/</code> 对应子文件夹；<br>
      2）在下方 <code>DATA</code> 列表中添加一行（标题、路径、单元、主题、标签）；<br>
      3）保存后目录页会自动更新。
    </p>

    <footer>© 《高级法语综合课》</footer>
  </div>

  <script>
    // ===== 目录数据（按需添加）=====
    // path 为相对 CO/ 的路径
    const DATA = [
      {
        title: "U3 · Perds tes rondeurs – Compréhension orale",
        path: "U3/exo1.html",
        unit: "U3",
        theme: "service en ligne",
        tags: ["CO", "écoute", "téléphone", "inscription", "application"],
      },
    ];

    // ===== 渲染逻辑（无需修改）=====
    const $ = (s) => document.querySelector(s);
    const list = $("#list"),
      empty = $("#empty"),
      q = $("#q"),
      unit = $("#unit"),
      theme = $("#theme"),
      chips = $("#chips");

    function uniq(a) {
      return Array.from(new Set(a)).filter(Boolean);
    }

    function populateFilters() {
      const units = uniq(DATA.map((x) => x.unit)).sort();
      const themes = uniq(DATA.map((x) => x.theme)).sort();

      units.forEach((u) => {
        const o = document.createElement("option");
        o.value = o.textContent = u;
        unit.appendChild(o);
      });

      themes.forEach((t) => {
        const o = document.createElement("option");
        o.value = o.textContent = t;
        theme.appendChild(o);
      });

      const quick = uniq([...units, ...themes]);
      chips.innerHTML = quick
        .map((t) => `<button class="chip" data-k="${t}">${t}</button>`)
        .join("");

      chips.addEventListener("click", (e) => {
        const k = e.target.dataset.k;
        if (!k) return;
        if (/^U\d+$/i.test(k)) unit.value = k;
        else theme.value = k;
        q.value = k;
        chips
          .querySelectorAll(".chip")
          .forEach((c) =>
            c.classList.toggle("active", c.dataset.k === k)
          );
        render(true);
      });
    }

    function render(pushURL) {
      const qw = q.value.trim().toLowerCase();
      const uf = unit.value;
      const tf = theme.value;

      const rows = DATA.filter((x) => {
        const inUnit = !uf || x.unit === uf;
        const inTheme = !tf || x.theme === tf;
        const hay = (
          x.title +
          " " +
          x.unit +
          " " +
          x.theme +
          " " +
          (x.tags || []).join(" ") +
          " " +
          x.path
        ).toLowerCase();
        const inQuery = !qw || hay.includes(qw);
        return inUnit && inTheme && inQuery;
      });

      list.innerHTML = "";
      rows.forEach((x) => {
        const a = document.createElement("a");
        a.href = x.path;
        a.className = "cardlink";
        a.innerHTML = `
          <div class="cardlink-title">${x.title}</div>
          <div class="cardlink-meta">
            ${x.unit || ""}${x.unit && x.theme ? " · " : ""}${
          x.theme || ""
        }
          </div>
          <div class="tags">
            ${(x.tags || [])
              .map((t) => `<span class="tag">${t}</span>`)
              .join("")}
          </div>
        `;
        list.appendChild(a);
      });

      empty.style.display = rows.length ? "none" : "block";

      if (pushURL) {
        const p = new URLSearchParams();
        if (qw) p.set("q", qw);
        if (uf) p.set("unit", uf);
        if (tf) p.set("theme", tf);
        const qs = p.toString();
        history.replaceState(null, "", qs ? "?" + qs : location.pathname);
      }
    }

    (function initFromURL() {
      const p = new URLSearchParams(location.search);
      if (p.get("q")) q.value = p.get("q");
      if (p.get("unit")) unit.value = p.get("unit");
      if (p.get("theme")) theme.value = p.get("theme");
    })();

    ["input", "change", "keyup"].forEach((ev) => {
      q.addEventListener(ev, () => render(true));
      unit.addEventListener(ev, () => render(true));
      theme.addEventListener(ev, () => render(true));
    });

    populateFilters();
    render(false);
  </script>
</body>
</html>
