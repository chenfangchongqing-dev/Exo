<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>词汇 Vocabulaire — 目录</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif; margin:0; background:#f6f8fb; color:#1f2937; }
    .wrap { max-width: 1080px; margin: 32px auto 80px; padding: 0 16px; }
    h1 { font-size: 28px; margin: 0 0 8px; }
    p.sub { margin:0 0 20px; color:#64748b; }
    .toolbar { display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin: 12px 0 18px; }
    .input, .select { height:40px; padding:0 12px; border:1px solid #d1d5db; border-radius:10px; background:#fff; outline:none; }
    .input { flex:1 1 260px; }
    .select { min-width:140px; }
    .grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap:14px; }
    .card { background:#fff; border:1px solid #e5e7eb; border-radius:16px; padding:16px; box-shadow:0 2px 6px rgba(0,0,0,.04); transition: transform .08s ease; }
    .card:hover { transform: translateY(-1px); }
    .title { font-weight:600; margin:0 0 8px; line-height:1.35; }
    .meta { font-size:12px; color:#64748b; margin-bottom:12px; }
    .tags { display:flex; flex-wrap:wrap; gap:6px; }
    .tag { font-size:11px; padding:4px 8px; background:#eef2ff; color:#374151; border-radius:999px; border:1px solid #e5e7eb; }
    .empty { background:#f1f5f9; border:1px dashed #cbd5e1; border-radius:14px; padding:18px; color:#64748b; }
    .hint { font-size:13px; color:#94a3b8; margin-top:10px; }
    a.btn { display:inline-block; margin-top:8px; font-size:13px; color:#2563eb; text-decoration:none; }
    .footer { margin-top:28px; color:#94a3b8; font-size:12px; }
  </style>
</head>
<body>
  <div class="wrap">
    <a href="/Exo/" class="btn">← 返回首页</a>
    <h1>词汇 Vocabulaire</h1>
    <p class="sub">支持按 <b>单元（U1…U9）</b> 与 <b>主题</b> 搜索与筛选。将练习 HTML 放到 <code>Vocabulaire/U1…U9/</code>，并在 DATA 里登记即可出现在列表中。</p>

    <div class="toolbar">
      <input id="q" class="input" type="search" placeholder="搜索：标题 / 单元（U1） / 主题 / 标签 / 路径…" />
      <select id="unit" class="select"></select>
      <select id="theme" class="select"></select>
    </div>

    <div id="list" class="grid"></div>
    <div id="empty" class="empty" style="display:none;">
      暂无匹配结果。
      <div class="hint">检查搜索词或筛选条件；或确认 DATA 中已登记该练习。</div>
    </div>

    <div class="footer">© 《高级法语综合课》</div>
  </div>

  <script>
    /***** 1) 维护你的练习清单（可以挪到 DATA.js 再通过 <script src> 引入） *****/
   const DATA = [
  /* --- U1 --- */
  { title: "U1 词汇｜（留空，待添加）", path: "Vocabulaire/U1/exo1.html", unit: "U1", theme: "", tags: [] },

  /* --- U2 --- */
  {
    title: "U2 词汇｜拖拽填空：solidarité & mobilisation",
    path: "/Exo/Vocabulaire/U2/exo1.html",   // 绝对路径，确保可访问
    unit: "U2",
    theme: "solidarité",
    tags: ["vocabulaire","slogans","soutenir","mobilisation","pétition","expulsions","régularisations"]
  },

  /* --- U3 --- */
  { title: "U3 词汇｜（留空，待添加）", path: "Vocabulaire/U3/exo1.html", unit: "U3", theme: "", tags: [] },

  /* --- U4 --- */
  { title: "U4 词汇｜（留空，待添加）", path: "Vocabulaire/U4/exo1.html", unit: "U4", theme: "", tags: [] },

  /* --- U5 --- */
  { title: "U5 词汇｜（留空，待添加）", path: "Vocabulaire/U5/exo1.html", unit: "U5", theme: "", tags: [] },

  /* --- U6 --- */
  { title: "U6 词汇｜（留空，待添加）", path: "Vocabulaire/U6/exo1.html", unit: "U6", theme: "", tags: [] },

  /* --- U7 --- */
  { title: "U7 词汇｜（留空，待添加）", path: "Vocabulaire/U7/exo1.html", unit: "U7", theme: "", tags: [] },

  /* --- U8 --- */
  { title: "U8 词汇｜（留空，待添加）", path: "Vocabulaire/U8/exo1.html", unit: "U8", theme: "", tags: [] },

  /* --- U9 --- */
  { title: "U9 词汇｜（留空，待添加）", path: "Vocabulaire/U9/exo1.html", unit: "U9", theme: "", tags: [] }
];



    /***** 2) 工具函数 *****/
    const $ = (sel) => document.querySelector(sel);
    const norm = (s) => (s ?? "").toString().trim().toLowerCase();
    function includesAny(hay, needle) { return norm(hay).includes(norm(needle)); }
    function toAbsOrRel(path) {
      // 允许既写 "Vocabulaire/..." 也写 "/Exo/Vocabulaire/..."
      if (path.startsWith("/")) return path;
      return "/Exo/" + path.replace(/^\/+/, "");
    }
    function getParams() {
      const u = new URL(location.href);
      return {
        q: u.searchParams.get("q") ?? "",
        unit: u.searchParams.get("unit") ?? "ALL",
        theme: u.searchParams.get("theme") ?? "ALL",
      };
    }
    function setParams({q, unit, theme}) {
      const u = new URL(location.href);
      if (q) u.searchParams.set("q", q); else u.searchParams.delete("q");
      if (unit && unit !== "ALL") u.searchParams.set("unit", unit); else u.searchParams.delete("unit");
      if (theme && theme !== "ALL") u.searchParams.set("theme", theme); else u.searchParams.delete("theme");
      history.replaceState(null, "", u);
    }
    function dedupe(arr) {
      return Array.from(new Set(arr.filter(Boolean)));
    }

    /***** 3) 下拉项：单元 & 主题 *****/
    function buildUnitOptions() {
      // 基础：U1..U9
      const baseUnits = Array.from({length:9}, (_,i)=>`U${i+1}`);
      // 追加：DATA 中出现的其他 unit（如 U10、Révision 等）
      const extra = dedupe(DATA.map(x=>x.unit)).filter(u => !baseUnits.includes(u));
      const units = ["ALL", ...baseUnits, ...extra];
      const sel = $("#unit");
      sel.innerHTML = units.map(v=>{
        const label = v==="ALL" ? "全部单元" : v;
        return `<option value="${v}">${label}</option>`;
      }).join("");
    }
    function buildThemeOptions() {
      const themes = ["ALL", ...dedupe(DATA.map(x=>x.theme).filter(Boolean).sort((a,b)=>a.localeCompare(b)))];
      const sel = $("#theme");
      sel.innerHTML = themes.map(v=>{
        const label = v==="ALL" ? "全部主题" : v;
        return `<option value="${v}">${label}</option>`;
      }).join("");
    }

    /***** 4) 过滤逻辑 *****/
    function filterList({q, unit, theme}) {
      return DATA.filter(item => {
        // 单元筛选
        if (unit && unit !== "ALL" && norm(item.unit) !== norm(unit)) return false;
        // 主题筛选
        if (theme && theme !== "ALL" && norm(item.theme) !== norm(theme)) return false;
        // 搜索匹配：title + unit + theme + tags + path
        const hay = [
          item.title, item.unit, item.theme,
          ...(Array.isArray(item.tags) ? item.tags : []),
          item.path
        ].join(" | ");
        return !q || includesAny(hay, q);
      });
    }

    /***** 5) 渲染列表 *****/
    function renderList(items) {
      const $list = $("#list");
      const $empty = $("#empty");
      if (!items.length) {
        $list.innerHTML = "";
        $empty.style.display = "block";
        return;
      }
      $empty.style.display = "none";
      $list.innerHTML = items.map(x => {
        const url = toAbsOrRel(x.path);
        const tagHtml = (x.tags || []).map(t=>`<span class="tag">${t}</span>`).join("");
        return `
          <a class="card" href="${url}">
            <div class="title">${x.title || "(未命名练习)"}</div>
            <div class="meta">单元：${x.unit || "-"}　主题：${x.theme || "-"}</div>
            <div class="tags">${tagHtml}</div>
          </a>
        `;
      }).join("");
    }

    /***** 6) 事件 & 状态同步 *****/
    function applyStateFromURL() {
      const {q, unit, theme} = getParams();
      $("#q").value = q;
      $("#unit").value = $("#unit").querySelector(`option[value="${unit}"]`) ? unit : "ALL";
      $("#theme").value = $("#theme").querySelector(`option[value="${theme}"]`) ? theme : "ALL";
      const items = filterList({q, unit: $("#unit").value, theme: $("#theme").value});
      renderList(items);
    }
    function bindEvents() {
      const onChange = () => {
        const q = $("#q").value.trim();
        const unit = $("#unit").value;
        const theme = $("#theme").value;
        setParams({q, unit, theme});
        renderList(filterList({q, unit, theme}));
      };
      // 简单防抖
      let timer = null;
      $("#q").addEventListener("input", () => {
        clearTimeout(timer);
        timer = setTimeout(onChange, 200);
      });
      $("#unit").addEventListener("change", onChange);
      $("#theme").addEventListener("change", onChange);
    }

    /***** 7) 启动 *****/
    buildUnitOptions();
    buildThemeOptions();
    bindEvents();
    applyStateFromURL();
  </script>
</body>
</html>
